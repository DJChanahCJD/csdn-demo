{% extends 'base.html' %}

{% block title %}
登录
{% endblock %}

{% block head %}
<script src="{% static 'js/login.js' %}"></script>
{% endblock %}

{% block content %}
<div class="col-md-6 offset-md-3 m-auto">
    <h2>登录</h2>
    <form method="post" action="">
        {% csrf_token %}
        <div class="mb-3">
            <label for="email" class="form-label">邮箱</label>
            <input type="text" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">密码</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" value="1" name="remember" id="checkDefault">
            <label class="form-check-label" for="checkDefault">
                保持登录状态
            </label>
        </div>
        <div class="mb-3">
            <button type="submit" class="btn btn-primary w-100" id="loginBtn">登录</button>
        </div>
    </form>
</div>
{% comment %} <script>
// 登录按钮点击事件
$('#loginBtn').click(function(e) {
    e.preventDefault()
    console.log('点击登录按钮')
    const email = $('#email').val();
    const password = $('#password').val();
    const remember = $('#checkDefault').is(':checked');

    // 发送JWT令牌请求
    $.ajax({
        url: '/api/custom-login/',
        type: 'POST',
        data: { email, password },   // 关键：序列化为 JSON
        headers: {
            'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val()
        },
        success: function(response) {
            // 存储令牌
            console.log("token:", response)
            localStorage.setItem('access_token', response.access);
            localStorage.setItem('refresh_token', response.refresh);
            // // 登录成功后重定向
            window.location.href = '/';
        },
        error: function(xhr) {
            let errorMsg = '登录失败，请检查邮箱和密码';
            if (xhr.responseJSON && xhr.responseJSON.detail) {
                errorMsg = xhr.responseJSON.detail;
            }
            alert(errorMsg);
        }
    });
});
</script> {% endcomment %}
{% endblock %}